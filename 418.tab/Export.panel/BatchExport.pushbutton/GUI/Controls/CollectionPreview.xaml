<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <ControlTemplate x:Key="CollectionPreviewTemplate" TargetType="ContentControl">
    <ControlTemplate.Resources>
      <!-- Convertisseur Boolean vers Visibility -->
      <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </ControlTemplate.Resources>
    <StackPanel>
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <!-- EN-TÊTE ET PROGRESSION -->
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <TextBlock Text="Recapitulatif : " FontWeight="Bold" Margin="0,0,0,6"/>
      
      <!-- Barre de progression de l'export -->
      <ProgressBar Name="ExportProgressBar"
                   Height="24" Minimum="0"
                   Maximum="100" Value="0" Margin="0,4,0,8"/>
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <!-- TABLEAU DE PRÉVISUALISATION DES COLLECTIONS -->
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <Border BorderThickness="0" Margin="0,0,0,8">
        <StackPanel>
          <!-- Compteur de collections et éléments -->
          <TextBlock Name="PreviewCounterText"
                     Margin="0,0,0,6"
                     Foreground="Gray"
                     Text="Collections: 0 • Éléments: 0"/>
          
          <!-- ListView avec GridView (style tableau) -->
          <ListView Name="CollectionGrid"
                    Height="200"
                    ScrollViewer.VerticalScrollBarVisibility="Auto"
                    ScrollViewer.HorizontalScrollBarVisibility="Auto"
                    BorderThickness="1"
                    BorderBrush="LightGray">
            <ListView.GroupStyle>
              <GroupStyle>
                <GroupStyle.ContainerStyle>
                  <Style TargetType="{x:Type GroupItem}">
                    <Setter Property="Template">
                      <Setter.Value>
                        <ControlTemplate TargetType="{x:Type GroupItem}">
                          <StackPanel>
                            <Border Background="#F0F0F0" BorderBrush="LightGray" BorderThickness="0,0,0,1" Padding="5">
                              <TextBlock Text="{Binding Name}" FontWeight="Bold" Foreground="#333333"/>
                            </Border>
                            <ItemsPresenter />
                          </StackPanel>
                        </ControlTemplate>
                      </Setter.Value>
                    </Setter>
                  </Style>
                </GroupStyle.ContainerStyle>
              </GroupStyle>
            </ListView.GroupStyle>
            <ListView.View>
              <GridView AllowsColumnReorder="False">
                
                <!-- Colonne 2: View/Sheet Number -->
                <GridViewColumn Header="View/Sheet Number" Width="100" DisplayMemberBinding="{Binding [SheetNumber]}"/>
                
                <!-- Colonne 3: View / Sheet Name -->
                <GridViewColumn Header="View / Sheet Name" Width="250" DisplayMemberBinding="{Binding [SheetName]}"/>

                <!-- Colonne 3b: Preview Name -->
                <GridViewColumn Header="Preview Name" Width="250" DisplayMemberBinding="{Binding [PreviewNom]}"/>
                
                <!-- Colonne 4: Format -->
                <GridViewColumn Header="Format" Width="60" DisplayMemberBinding="{Binding [Format]}"/>
                
                <!-- Colonne 5: Size -->
                <GridViewColumn Header="Size" Width="50" DisplayMemberBinding="{Binding [Size]}"/>
                
                <!-- Colonne 6: Orientation -->
                <GridViewColumn Header="Orientation" Width="80" DisplayMemberBinding="{Binding [Orientation]}"/>
                
                <!-- Colonne 7: Progress -->
                <GridViewColumn Header="Progress" Width="120">
                  <GridViewColumn.CellTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding [Progress]}" 
                                 Foreground="{Binding [ProgressColor]}"/>
                    </DataTemplate>
                  </GridViewColumn.CellTemplate>
                </GridViewColumn>
              </GridView>
            </ListView.View>
          </ListView>
        </StackPanel>
      </Border>
      
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <!-- BARRE D'ACTION (Statut + Bouton Export) -->
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <DockPanel LastChildFill="False" Margin="0,8,0,0">
        <!-- Message de statut (erreurs, avertissements) -->
        <TextBlock Name="ExportStatusText"
                   VerticalAlignment="Center"
                   Margin="0,0,8,0"
                   TextWrapping="Wrap"
                   Width="Auto"
                   DockPanel.Dock="Left"
                   Foreground="Red"
                   Text="Sélectionnez un dossier de destination valide."/>
        
        <!-- Bouton pour lancer l'export -->
        <Button Name="ExportButton"
                Content="Exporter"
                Height="32"
                MinWidth="120"
                HorizontalAlignment="Right"
                DockPanel.Dock="Right"
                IsEnabled="False"/>
      </DockPanel>
    </StackPanel>
  </ControlTemplate>
</ResourceDictionary>
