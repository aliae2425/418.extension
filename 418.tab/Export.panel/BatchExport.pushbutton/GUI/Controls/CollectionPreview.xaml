<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <ControlTemplate x:Key="CollectionPreviewTemplate" TargetType="ContentControl">
    <ControlTemplate.Resources>
      <!-- Convertisseur Boolean vers Visibility -->
      <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </ControlTemplate.Resources>
    <StackPanel>
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <!-- EN-TÊTE ET PROGRESSION -->
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <TextBlock Text="Recapitulatif : " 
                  Foreground="{DynamicResource TextPrimaryBrush}"
                  FontWeight="Bold" Margin="0,0,0,6"/>
      
      <!-- Barre de progression de l'export -->
      <ProgressBar Name="ExportProgressBar"
                   Height="24" Minimum="0"
                   Maximum="100" Value="0" Margin="0,4,0,8"/>
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <!-- TABLEAU DE PRÉVISUALISATION DES COLLECTIONS -->
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <Border BorderThickness="0" Margin="0,0,0,8">
        <StackPanel>
          <!-- Compteur de collections et éléments -->
          <TextBlock Name="PreviewCounterText"
                     Margin="0,0,0,6"
                     Foreground="{DynamicResource TextSecondaryBrush}"
                     Text="Collections: 0 • Éléments: 0"/>
          
          <!-- ListView avec GridView (style tableau) -->
          <ListView Name="CollectionGrid"
                    Height="200"
                    ScrollViewer.VerticalScrollBarVisibility="Auto"
                    ScrollViewer.HorizontalScrollBarVisibility="Auto"
                    BorderThickness="1"
                    BorderBrush="{DynamicResource ControlBorderBrush}">
            <ListView.GroupStyle>
              <GroupStyle>
                <GroupStyle.ContainerStyle>
                  <Style TargetType="{x:Type GroupItem}">
                    <Setter Property="Template">
                      <Setter.Value>
                        <ControlTemplate TargetType="{x:Type GroupItem}">
                          <Expander IsExpanded="False" BorderThickness="0,0,0,1" BorderBrush="{DynamicResource ControlBorderBrush}"
                                    IsEnabled="{Binding Items[0][CollectionIsExported]}">
                            <Expander.Header>
                                <Grid Height="25" Width="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ListView}}, Path=ActualWidth}">
                                    <Grid.ColumnDefinitions>
                                      <ColumnDefinition Width="100"/>
                                      <ColumnDefinition Width="350"/>
                                      <ColumnDefinition Width="100"/>
                                      <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Content -->
                                    <TextBlock Grid.Column="0" Text="{Binding Name}"
                                              FontStyle="Italic" VerticalAlignment="Center" Margin="5,0"/>
                                    <TextBlock Grid.Column="1" Text="{Binding Items[0][CollectionPreviewName]}" 
                                              FontWeight="Bold" VerticalAlignment="Center" Margin="5,0" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                    <TextBlock Grid.Column="2" Text="{Binding Items[0][SheetCount], StringFormat='{}{0} feuilles'}"
                                              FontStyle="Italic"  VerticalAlignment="Center" Margin="5,0"/>
                                    <TextBlock Grid.Column="3" Text="{Binding Items[0][CollectionExportInfo]}" 
                                              FontSize="10" VerticalAlignment="Center" Margin="5,0" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                </Grid>
                            </Expander.Header>
                            <ItemsPresenter />
                          </Expander>
                        </ControlTemplate>
                      </Setter.Value>
                    </Setter>
                  </Style>
                </GroupStyle.ContainerStyle>
              </GroupStyle>
            </ListView.GroupStyle>
            <ListView.View>
              <GridView AllowsColumnReorder="False">
                
                <!-- Colonne 2: View/Sheet Number -->
                <GridViewColumn Header="numéro" Width="60" DisplayMemberBinding="{Binding [SheetNumber]}"/>
                
                <!-- Colonne 3: View / Sheet Name -->
                <GridViewColumn Header="nom" Width="100" DisplayMemberBinding="{Binding [SheetName]}"/>

                <!-- Colonne 3b: Preview Name -->
                <GridViewColumn Header="nom d'export" Width="320" DisplayMemberBinding="{Binding [PreviewNom]}"/>
                
                <!-- Colonne 4: Format -->
                <GridViewColumn Header="Format" Width="60" DisplayMemberBinding="{Binding [Format]}"/>
                
                <!-- Colonne 5: Size -->
                <GridViewColumn Header="Taille" Width="50" DisplayMemberBinding="{Binding [Size]}"/>
                
                <!-- Colonne 6: Orientation -->
                <GridViewColumn Header="Orientation" Width="80" DisplayMemberBinding="{Binding [Orientation]}"/>

                <!-- Colonne 7: Progress -->
                <GridViewColumn Header="Progress" Width="120">
                  <GridViewColumn.CellTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding [Progress]}" 
                                 Foreground="{Binding [ProgressColor]}"/>
                    </DataTemplate>
                  </GridViewColumn.CellTemplate>
                </GridViewColumn>
              </GridView>
            </ListView.View>
          </ListView>
        </StackPanel>
      </Border>
      
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <!-- BARRE D'ACTION (Statut + Bouton Export) -->
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <DockPanel LastChildFill="False" Margin="0,8,0,0">
        <!-- Message de statut (erreurs, avertissements) -->
        <TextBlock Name="ExportStatusText"
                   VerticalAlignment="Center"
                   Margin="0,0,8,0"
                   TextWrapping="Wrap"
                   Width="Auto"
                   DockPanel.Dock="Left"
                   Foreground="Red"
                   Text="Sélectionnez un dossier de destination valide."/>
        
        <!-- Bouton pour lancer l'export -->
        <Button Name="ExportButton"
                Content="Exporter"
                Height="32"
                MinWidth="120"
                HorizontalAlignment="Right"
                DockPanel.Dock="Right"
                IsEnabled="False"/>
      </DockPanel>
    </StackPanel>
  </ControlTemplate>
</ResourceDictionary>
