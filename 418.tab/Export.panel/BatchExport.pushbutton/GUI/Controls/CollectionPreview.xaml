<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <ControlTemplate x:Key="CollectionPreviewTemplate" TargetType="ContentControl">
    <StackPanel>
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <!-- EN-TÊTE ET PROGRESSION -->
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <TextBlock Text="Recapitulatif : " FontWeight="Bold" Margin="0,0,0,6"/>
      
      <!-- Barre de progression de l'export -->
      <ProgressBar Name="ExportProgressBar"
                   Height="24" Minimum="0"
                   Maximum="100" Value="0" Margin="0,4,0,8"/>
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <!-- TABLEAU DE PRÉVISUALISATION DES COLLECTIONS -->
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <Border BorderThickness="0" Margin="0,0,0,8">
        <StackPanel>
          <!-- Compteur de collections et éléments -->
          <TextBlock Name="PreviewCounterText"
                     Margin="0,0,0,6"
                     Foreground="Gray"
                     Text="Collections: 0 • Éléments: 0"/>
          
          <!-- Grille principale des collections -->
          <DataGrid Name="CollectionGrid"
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    HeadersVisibility="Column"
                    RowDetailsVisibilityMode="VisibleWhenSelected"
                    GridLinesVisibility="None"
                    CanUserAddRows="False"
                    CanUserDeleteRows="False"
                    Height="200"
                    ScrollViewer.VerticalScrollBarVisibility="Auto"
                    ScrollViewer.CanContentScroll="True">
            <DataGrid.Columns>
              <!-- ─────────────────────────────────────────────────────── -->
              <!-- COLONNES DU TABLEAU PRINCIPAL -->
              <!-- ─────────────────────────────────────────────────────── -->
              
              <!-- Colonne 1: Indicateur expand/collapse (▶/▼) -->
              <DataGridTemplateColumn Header="" Width="28">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="Gray" FontSize="14">
                      <TextBlock.Style>
                        <Style TargetType="TextBlock">
                          <Setter Property="Text" Value="▶"/>
                          <Style.Triggers>
                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridRow}}" Value="True">
                              <Setter Property="Text" Value="▼"/>
                            </DataTrigger>
                          </Style.Triggers>
                        </Style>
                      </TextBlock.Style>
                    </TextBlock>
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              
              <!-- Colonne 2: Nom de la collection (largeur flexible) -->
              <DataGridTextColumn Header="Nom" Binding="{Binding [Nom]}" Width="5*"/>
              
              <!-- Colonne 3: Nombre de feuilles (largeur fixe) -->
              <DataGridTextColumn Header="Feuilles" Binding="{Binding [Feuilles]}" Width="80"/>
              
              <!-- Colonne 4: Export PDF (✓/✗) -->
              <DataGridTemplateColumn Header="Export" Width="70">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding [ExportText]}" Foreground="{Binding [ExportColor]}" HorizontalAlignment="Center"/>
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              
              <!-- Colonne 5: Export par feuille/Carnet (✓/✗) -->
              <DataGridTemplateColumn Header="Carnet" Width="70">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding [CarnetText]}" Foreground="{Binding [CarnetColor]}" HorizontalAlignment="Center"/>
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              
              <!-- Colonne 6: Export DWG (✓/✗) -->
              <DataGridTemplateColumn Header="DWG" Width="70">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding [DWGText]}" Foreground="{Binding [DWGColor]}" HorizontalAlignment="Center"/>
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              
              <!-- Colonne 7: Statut d'export (En cours, Terminé, Erreur) -->
              <DataGridTemplateColumn Header="Statut" Width="2*">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding [StatutText]}" Foreground="{Binding [StatutColor]}"/>
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
            </DataGrid.Columns>
            
            <!-- ─────────────────────────────────────────────────────── -->
            <!-- DÉTAILS DES FEUILLES (expand) -->
            <!-- ─────────────────────────────────────────────────────── -->
            <DataGrid.RowDetailsTemplate>
              <DataTemplate>
                <Border Margin="0,6,0,8" Padding="28,0,0,0">
                  <!-- Sous-grille affichant les feuilles individuelles -->
                  <DataGrid ItemsSource="{Binding [Details]}"
                            AutoGenerateColumns="False"
                            IsReadOnly="True"
                            HeadersVisibility="Column"
                            GridLinesVisibility="None"
                            CanUserAddRows="False"
                            CanUserDeleteRows="False"
                            Background="Transparent"
                            BorderThickness="0">
                    <DataGrid.Columns>
                      <!-- Nom du fichier exporté (aligné avec colonne Nom du parent) -->
                      <DataGridTextColumn Header="Nom" Binding="{Binding [Nom]}" Width="*"/>
                      <!-- Format d'export (aligné avec Feuilles du parent) -->
                      <DataGridTextColumn Header="Format" Binding="{Binding [Format]}" Width="80"/>
                      <!-- Statut de l'export individuel (aligné avec Export+Carnet+DWG+Statut) -->
                      <DataGridTemplateColumn Header="Statut" Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                          <DataTemplate>
                            <TextBlock Text="{Binding [StatutText]}" Foreground="{Binding [StatutColor]}"/>
                          </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                      </DataGridTemplateColumn>
                    </DataGrid.Columns>
                  </DataGrid>
                </Border>
              </DataTemplate>
            </DataGrid.RowDetailsTemplate>
          </DataGrid>
        </StackPanel>
      </Border>
      
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <!-- BARRE D'ACTION (Statut + Bouton Export) -->
      <!-- ═══════════════════════════════════════════════════════════════ -->
      <DockPanel LastChildFill="False" Margin="0,8,0,0">
        <!-- Message de statut (erreurs, avertissements) -->
        <TextBlock Name="ExportStatusText"
                   VerticalAlignment="Center"
                   Margin="0,0,8,0"
                   TextWrapping="Wrap"
                   Width="Auto"
                   DockPanel.Dock="Left"
                   Foreground="Red"
                   Text="Sélectionnez un dossier de destination valide."/>
        
        <!-- Bouton pour lancer l'export -->
        <Button Name="ExportButton"
                Content="Exporter"
                Height="32"
                MinWidth="120"
                HorizontalAlignment="Right"
                DockPanel.Dock="Right"
                IsEnabled="False"/>
      </DockPanel>
    </StackPanel>
  </ControlTemplate>
</ResourceDictionary>
