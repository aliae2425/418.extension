<Grid xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <!-- Conteneur principal de la section de prévisualisation -->
  <StackPanel>
    <!-- Titre et barre de progression globale -->
    <TextBlock Text="Recapitulatif : " FontWeight="Bold" Margin="0,0,0,6"/>
    <ProgressBar Name="ExportProgressBar" Height="24" Minimum="0" Maximum="100" Value="0" Margin="0,4,0,8"/>

    <!-- Bloc contenant le tableau récapitulatif -->
    <Border BorderThickness="0" Margin="0,0,0,8">
      <StackPanel>
        <!-- Sous‑titre : compte de collections / éléments -->
        <TextBlock Name="PreviewCounterText" Margin="0,0,0,6" Foreground="Gray" Text="Collections: 0 • Éléments: 0"/>
        <!-- DataGrid principal : liste des collections -->
        <DataGrid Name="CollectionGrid"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  HeadersVisibility="Column"
                  RowDetailsVisibilityMode="Collapsed"
                  GridLinesVisibility="None"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False">
          <!-- Gestion de l’affichage des détails (extension/repli) -->
          <DataGrid.RowStyle>
            <Style TargetType="DataGridRow">
              <Setter Property="DetailsVisibility" Value="Collapsed"/>
              <Style.Triggers>
                <DataTrigger Binding="{Binding [IsExpanded]}" Value="True">
                  <Setter Property="DetailsVisibility" Value="Visible"/>
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </DataGrid.RowStyle>

          <!-- Colonnes du tableau principal -->
          <DataGrid.Columns>
            <DataGridTemplateColumn Header="" Width="28">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="Gray" FontSize="14">
                    <TextBlock.Style>
                      <Style TargetType="TextBlock">
                        <Setter Property="Text" Value="▶"/>
                        <Style.Triggers>
                          <DataTrigger Binding="{Binding [IsExpanded]}" Value="True">
                            <Setter Property="Text" Value="▼"/>
                          </DataTrigger>
                        </Style.Triggers>
                      </Style>
                    </TextBlock.Style>
                  </TextBlock>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>
            <!-- Nom de la collection et nombre de feuilles -->
            <DataGridTextColumn Header="Nom" Binding="{Binding [Nom]}" Width="3*"/>
            <DataGridTextColumn Header="Feuilles" Binding="{Binding [Feuilles]}" Width="1*"/>
            <!-- Statuts d’export par format -->
            <DataGridTemplateColumn Header="Export" Width="1.2*">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding [ExportText]}" Foreground="{Binding [ExportColor]}"/>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>
            <DataGridTemplateColumn Header="Carnet" Width="1.2*">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding [CarnetText]}" Foreground="{Binding [CarnetColor]}"/>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>
            <DataGridTemplateColumn Header="DWG" Width="1.2*">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding [DWGText]}" Foreground="{Binding [DWGColor]}"/>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>
            <DataGridTemplateColumn Header="Statut" Width="1.6*">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding [StatutText]}" Foreground="{Binding [StatutColor]}"/>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>
          </DataGrid.Columns>
          <!-- Détails par élément (feuille) de chaque collection -->
          <DataGrid.RowDetailsTemplate>
            <DataTemplate>
              <Border Margin="0,6,0,8" Padding="0">
                <DataGrid ItemsSource="{Binding [Details]}" AutoGenerateColumns="False" IsReadOnly="True" HeadersVisibility="Column" GridLinesVisibility="None" CanUserAddRows="False" CanUserDeleteRows="False">
                  <DataGrid.Columns>
                    <DataGridTextColumn Header="Nom" Binding="{Binding [Nom]}" Width="3*"/>
                    <DataGridTextColumn Header="Format" Binding="{Binding [Format]}" Width="2*"/>
                    <DataGridTemplateColumn Header="Statut" Width="2*">
                      <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                          <TextBlock Text="{Binding [StatutText]}" Foreground="{Binding [StatutColor]}"/>
                        </DataTemplate>
                      </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                  </DataGrid.Columns>
                </DataGrid>
              </Border>
            </DataTemplate>
          </DataGrid.RowDetailsTemplate>
        </DataGrid>
      </StackPanel>
    </Border>
    <!-- Zone de statut et bouton de lancement de l’export -->
    <DockPanel LastChildFill="False" Margin="0,8,0,0">
      <TextBlock Name="ExportStatusText" VerticalAlignment="Center" Margin="0,0,8,0" TextWrapping="Wrap" Width="Auto" DockPanel.Dock="Left" Foreground="Red" Text="Sélectionnez un dossier de destination valide."/>
      <Button Name="ExportButton" Content="Exporter" Height="32" MinWidth="120" HorizontalAlignment="Right" DockPanel.Dock="Right" IsEnabled="False"/>
    </DockPanel>
  </StackPanel>
</Grid>
