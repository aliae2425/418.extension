<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Piker"
        Height="520" Width="840"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        ResizeMode="NoResize"
        AllowsTransparency="True"
        Background="{DynamicResource TransparentBrush}"
        BorderThickness="1">
  
  <Window.Resources>
    <ResourceDictionary>
      <!-- Resources injected via code-behind to avoid relative path issues -->
    </ResourceDictionary>
  </Window.Resources>

  <Border CornerRadius="8" Background="{DynamicResource WindowBackgroundBrush}" BorderBrush="{DynamicResource ControlBorderBrush}" BorderThickness="1">
    <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <!-- Custom Title Bar -->
    <Grid Grid.Row="0" Name="TitleBar" Background="{DynamicResource TransparentBrush}" Margin="0">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
      </Grid.ColumnDefinitions>
      
      <TextBlock Name="TitleText" 
                 Text="Configuration du nommage" 
                 Style="{DynamicResource HeaderTextBlockStyle}" 
                 Margin="16,16,0,0"
                 VerticalAlignment="Center"/>

      <Button Name="CloseWindowButton" 
              Grid.Column="1" 
              Content="âœ•" 
              Width="40" Height="40" 
              Margin="0,4,4,0"
              VerticalAlignment="Top"
              Background="{DynamicResource TransparentBrush}" 
              BorderThickness="0" 
              Foreground="{DynamicResource TextPrimaryBrush}"
              FontSize="16" 
              Cursor="Hand">
         <Button.Template>
             <ControlTemplate TargetType="Button">
                 <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="8">
                     <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                 </Border>
                 <ControlTemplate.Triggers>
                     <Trigger Property="IsMouseOver" Value="True">
                     <Setter TargetName="border" Property="Background" Value="{DynamicResource CloseButtonHoverBrush}"/>
                     <Setter Property="Foreground" Value="{DynamicResource TextOnDangerBrush}"/>
                     </Trigger>
                 </ControlTemplate.Triggers>
             </ControlTemplate>
         </Button.Template>
      </Button>
    </Grid>

    <!-- Main Content -->
    <Grid Grid.Row="1" Margin="16,8,16,16">
      <Grid.RowDefinitions>
        <RowDefinition Height="*"/>
        <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>

      <!-- zoneCentrale: gauche = filtres + paramÃ¨tres; centre = boutons; droite = DataGrid des paramÃ¨tres choisis -->
      <Grid Grid.Row="0" Margin="0,0,0,12">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="280"/>
          <ColumnDefinition Width="80"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- leftSection refactor: layout fluide sans hauteur fixe -->
        <Border Grid.Column="0" Style="{DynamicResource CardStyle}" Margin="0,0,8,0">
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <TextBlock Grid.Row="0" Text="Source des paramÃ¨tres" FontWeight="Bold" Margin="0,0,0,8"/>
            <ComboBox Grid.Row="1" Name="ScopeCombo" Margin="0,0,0,8">
              <ComboBoxItem Content="Tout" IsSelected="True"/>
              <ComboBoxItem Content="Projet"/>
              <ComboBoxItem Content="Collection"/>
              <ComboBoxItem Content="Feuille"/>
              <ComboBoxItem Content="System"/>
            </ComboBox>
            <Grid Grid.Row="2" Margin="0,0,0,8">
                <TextBox Name="SearchBox" ToolTip="Rechercher un paramÃ¨tre..." Padding="2,0,24,0"/>
                <Path Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" 
                      Fill="{DynamicResource TextSecondaryBrush}" 
                      Stretch="Uniform" 
                      Width="14" Height="14" 
                      HorizontalAlignment="Right" 
                      Margin="0,0,8,0"
                      IsHitTestVisible="False"/>
            </Grid>
            <TextBlock Grid.Row="3" Text="ParamÃ¨tres disponibles" FontWeight="Bold" Margin="0,4,0,4"/>
            <ListBox Grid.Row="4" Name="AvailableParamsList" MouseDoubleClick="AvailableParamsList_DoubleClick" BorderThickness="1" BorderBrush="{DynamicResource ControlBorderBrush}"/>
          </Grid>
        </Border>

        <!-- middleButtons: actions ajouter / retirer -->
        <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center">
          <Button Name="AddParamButton" Content="Ajouter â†’" Width="74" Margin="0,0,0,8"/>
          <Button Name="RemoveParamButton" Content="â† Supprimer" Width="74"/>
        </StackPanel>

        <!-- rightGrid refactor: remplacement DataGrid par ListBox item template, layout fluide -->
        <Border Grid.Column="2" Style="{DynamicResource CardStyle}">
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
              <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <TextBlock Grid.Row="0" Text="ParamÃ¨tres choisis" FontWeight="Bold" Margin="0,0,0,8"/>
            <ListBox Grid.Row="1" Name="SelectedParamsList" MouseDoubleClick="SelectedParamsList_DoubleClick" BorderThickness="1" BorderBrush="{DynamicResource ControlBorderBrush}">
              <ListBox.ItemContainerStyle>
                <Style TargetType="ListBoxItem">
                  <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                  <Setter Property="Padding" Value="4"/>
                </Style>
              </ListBox.ItemContainerStyle>
              <ListBox.ItemTemplate>
                <DataTemplate>
                  <Grid Margin="0,2">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="*"/>
                      <ColumnDefinition Width="*"/>
                      <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBox Grid.Column="0" Margin="0,0,4,0" HorizontalAlignment="Stretch"
                             Text="{Binding [Prefix], Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             LostFocus="ParamCell_LostFocus"
                             TextChanged="ParamCell_TextChanged"/>
                    <TextBlock Grid.Column="1" Text="{Binding [Name]}" VerticalAlignment="Center" Margin="4,0" FontWeight="SemiBold"/>
                    <TextBox Grid.Column="2" Margin="4,0,0,0" HorizontalAlignment="Stretch"
                             Text="{Binding [Suffix], Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             LostFocus="ParamCell_LostFocus"
                             TextChanged="ParamCell_TextChanged"/>
                  </Grid>
                </DataTemplate>
              </ListBox.ItemTemplate>
            </ListBox>
            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
              <Button Name="MoveTopButton" Content="â«" Width="40" Margin="0,0,4,0" Click="MoveTopButton_Click" ToolTip="DÃ©placer tout en haut"/>
              <Button Name="MoveUpButton" Content="ðŸ”¼" Width="40" Margin="0,0,4,0" Click="MoveUpButton_Click"/>
              <Button Name="MoveDownButton" Content="ðŸ”½" Width="40" Margin="0,0,4,0" Click="MoveDownButton_Click"/>
              <Button Name="MoveBottomButton" Content="â¬" Width="40" Click="MoveBottomButton_Click" ToolTip="DÃ©placer tout en bas"/>
            </StackPanel>
          </Grid>
        </Border>
      </Grid>

      <!-- AperÃ§u du pattern rÃ©sultant -->
      <Border Grid.Row="1" Style="{DynamicResource CardStyle}">
        <StackPanel Orientation="Vertical">
          <TextBlock Text="AperÃ§u" FontWeight="Bold" Margin="0,0,0,4"/>
          <TextBlock Text="Chaque ligne gÃ©nÃ¨re: PrÃ©fix + {ParamÃ¨tre} + Suffix. L'ensemble est concatÃ©nÃ©." 
                     FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,0,8"/>
          <Border Background="{DynamicResource ControlFillBrush}" BorderBrush="{DynamicResource ControlBorderBrush}" BorderThickness="1" CornerRadius="8" Padding="8">
               <TextBlock Name="PatternPreviewText" Text="" Foreground="{DynamicResource TextPrimaryBrush}" FontFamily="Consolas"/>
          </Border>
          
          <DockPanel Margin="0,16,0,0" LastChildFill="False">
            <Button Name="CancelButton" Content="Annuler" Width="100" Margin="0,0,8,0" />
            <Button Name="OkButton" Content="OK" Width="100" Style="{DynamicResource PrimaryButtonStyle}"/>
          </DockPanel>
        </StackPanel>
      </Border>
    </Grid>
    </Grid>
  </Border>
</Window>
