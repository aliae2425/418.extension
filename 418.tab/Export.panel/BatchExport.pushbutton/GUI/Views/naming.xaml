<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Piker"
        Height="520" Width="840"
        WindowStartupLocation="CenterOwner">
  <Grid Margin="12">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <TextBlock Text="Configuration du nommage" FontSize="16" FontWeight="Bold"/>

    <!-- zoneCentrale: gauche = filtres + paramètres; centre = boutons; droite = DataGrid des paramètres choisis -->
    <Grid Grid.Row="1" Margin="0,8,0,8">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="280"/>
        <ColumnDefinition Width="80"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- leftSection refactor: layout fluide sans hauteur fixe -->
      <Border Grid.Column="0" BorderBrush="#CCC" BorderThickness="1" CornerRadius="4" Padding="8" Margin="0,0,8,0">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>
          <TextBlock Grid.Row="0" Text="Source des paramètres" FontWeight="Bold"/>
          <ComboBox Grid.Row="1" Name="ScopeCombo" Margin="0,4,0,8">
            <ComboBoxItem Content="Tout" IsSelected="True"/>
            <ComboBoxItem Content="Projet"/>
            <ComboBoxItem Content="Collection"/>
            <ComboBoxItem Content="Feuille"/>
          </ComboBox>
          <TextBlock Grid.Row="2" Text="Paramètres disponibles" FontWeight="Bold" Margin="0,2,0,4"/>
          <ListBox Grid.Row="3" Name="AvailableParamsList" MouseDoubleClick="AvailableParamsList_DoubleClick"/>
        </Grid>
      </Border>

      <!-- middleButtons: actions ajouter / retirer -->
      <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center">
        <Button Name="AddParamButton" Content="Ajouter →" Width="74" Height="28" Margin="0,0,0,8"/>
        <Button Name="RemoveParamButton" Content="← Supprimer" Width="74" Height="28"/>
      </StackPanel>

      <!-- rightGrid refactor: remplacement DataGrid par ListBox item template, layout fluide -->
      <Border Grid.Column="2" BorderBrush="#CCC" BorderThickness="1" CornerRadius="4" Padding="8">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>
          <TextBlock Grid.Row="0" Text="Paramètres choisis" FontWeight="Bold" Margin="0,0,0,6"/>
          <ListBox Grid.Row="1" Name="SelectedParamsList" MouseDoubleClick="SelectedParamsList_DoubleClick">
            <ListBox.ItemContainerStyle>
              <Style TargetType="ListBoxItem">
                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
              </Style>
            </ListBox.ItemContainerStyle>
            <ListBox.ItemTemplate>
              <DataTemplate>
                <Grid Margin="0,0,0,4">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                  </Grid.ColumnDefinitions>
                  <TextBox Grid.Column="0" Margin="0" HorizontalAlignment="Stretch"
                           Text="{Binding [Prefix], Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                           LostFocus="ParamCell_LostFocus"
                           TextChanged="ParamCell_TextChanged"/>
                  <TextBlock Grid.Column="1" Text="{Binding [DisplayName]}" VerticalAlignment="Center" Margin="0"/>
                  <TextBox Grid.Column="2" Margin="0" HorizontalAlignment="Stretch"
                           Text="{Binding [Suffix], Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                           LostFocus="ParamCell_LostFocus"
                           TextChanged="ParamCell_TextChanged"/>
                </Grid>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>
          <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
            <Button Name="MoveTopButton" Content="⏮ Haut" Width="70" Height="26" Margin="0,0,8,0" Click="MoveTopButton_Click"/>
            <Button Name="MoveUpButton" Content="▲" Width="40" Height="26" Margin="0,0,8,0" Click="MoveUpButton_Click"/>
            <Button Name="MoveDownButton" Content="▼" Width="40" Height="26" Margin="0,0,8,0" Click="MoveDownButton_Click"/>
            <Button Name="MoveBottomButton" Content="⏭ Bas" Width="70" Height="26" Click="MoveBottomButton_Click"/>
          </StackPanel>
        </Grid>
      </Border>
    </Grid>

    <!-- Aperçu du pattern résultant -->
    <Border Grid.Row="2" BorderBrush="#DDD" BorderThickness="1" CornerRadius="4" Padding="8" Margin="0,0,0,8">
      <StackPanel Orientation="Vertical">
        <TextBlock Text="Aperçu" FontWeight="Bold"/>
        <TextBlock Text="Chaque ligne génère: Préfix + {Paramètre} + Suffix. L'ensemble est concaténé." FontSize="11" Foreground="#666"/>
        <TextBlock Name="PatternPreviewText" Text="" Margin="0,4,0,0" Foreground="#333" FontFamily="Consolas"/>
        <DockPanel Margin="0,8,0,0" LastChildFill="False">
          <Button Name="CancelButton" Content="Annuler" Width="110" Height="30" Margin="0,0,8,0" />
          <Button Name="OkButton" Content="OK" Width="110" Height="30" />
        </DockPanel>
      </StackPanel>
    </Border>
  </Grid>
</Window>
